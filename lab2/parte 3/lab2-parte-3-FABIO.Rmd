---
title: "Problema 2"
output: html_notebook
---

```{r, message=FALSE, warning=FALSE}
require(magrittr)
require(dplyr)
require(ggplot2)
require(reshape2)
require(readr)
require(caret)

##### INICIO PRE PROCESSAMENTO DOS DADOS #####

WORKING.DIR <- "/Users/ffosilva/repos/ad2/lab2"
setwd(WORKING.DIR)

graduados.treino <- read_csv("graduados_treino.csv", col_types = cols(ALU_NOVAMATRICULA = col_character())) %>%
  mutate(ALU_NOVAMATRICULA = as.factor(ALU_NOVAMATRICULA))

graduados.treino <- graduados.treino %>%
  arrange(ALU_NOVAMATRICULA)

graduados.treino.clean <- graduados.treino %>%
  filter(!is.na(MAT_MEDIA_FINAL))

graduados.treino.cra <- graduados.treino.clean %>%
  group_by(ALU_NOVAMATRICULA) %>%
  mutate(cra.contrib = MAT_MEDIA_FINAL*CREDITOS) %>%
  summarise(cra = sum(cra.contrib)/sum(CREDITOS))

graduados.treino.model.input <- graduados.treino.clean %>%
  group_by(ALU_NOVAMATRICULA,DISCIPLINA)  %>%
  filter(MAT_MEDIA_FINAL == max(MAT_MEDIA_FINAL)) %>%
  ungroup() %>%
  select(ALU_NOVAMATRICULA,DISCIPLINA,MAT_MEDIA_FINAL) %>% 
  mutate(DISCIPLINA = as.factor(gsub(" ",".",DISCIPLINA))) %>%
  dcast(ALU_NOVAMATRICULA ~ DISCIPLINA, mean) %>%
  merge(graduados.treino.cra) %>%
  na.omit() %>%
  select(`Cálculo.Diferencial.e.Integral.I`,
         `Álgebra.Vetorial.e.Geometria.Analítica`,
         `Leitura.e.Produção.de.Textos`,
         `Programação.I`,
         `Introdução.à.Computação`,
         `Laboratório.de.Programação.I`, # fim primeiro período
         `Cálculo.Diferencial.e.Integral.II`,
         `Matemática.Discreta`,
         `Programação.II`,
         `Teoria.dos.Grafos`,
         `Fundamentos.de.Física.Clássica`,
         `Laboratório.de.Programação.II`,
         `cra`)

graduados.teste <- read_csv("graduados_teste.csv", col_types = cols(ALU_NOVAMATRICULA = col_character())) %>%
  mutate(ALU_NOVAMATRICULA = as.factor(ALU_NOVAMATRICULA))

graduados.teste <- graduados.teste %>%
  arrange(ALU_NOVAMATRICULA)

graduados.teste.clean <- graduados.teste %>%
  filter(!is.na(MAT_MEDIA_FINAL))

graduados.teste.cra <- graduados.teste.clean %>%
  group_by(ALU_NOVAMATRICULA) %>%
  mutate(cra.contrib = MAT_MEDIA_FINAL*CREDITOS) %>%
  summarise(cra = sum(cra.contrib)/sum(CREDITOS))

graduados.teste.model.input <- graduados.teste.clean %>%
  group_by(ALU_NOVAMATRICULA,DISCIPLINA)  %>%
  filter(MAT_MEDIA_FINAL == max(MAT_MEDIA_FINAL)) %>%
  ungroup() %>%
  select(ALU_NOVAMATRICULA,DISCIPLINA,MAT_MEDIA_FINAL) %>% 
  mutate(DISCIPLINA = as.factor(gsub(" ",".",DISCIPLINA))) %>%
  dcast(ALU_NOVAMATRICULA ~ DISCIPLINA, mean) %>%
  merge(graduados.teste.cra) %>%
  na.omit() %>%
  select(`Cálculo.Diferencial.e.Integral.I`,
         `Álgebra.Vetorial.e.Geometria.Analítica`,
         `Leitura.e.Produção.de.Textos`,
         `Programação.I`,
         `Introdução.à.Computação`,
         `Laboratório.de.Programação.I`, # fim primeiro período
         `Cálculo.Diferencial.e.Integral.II`,
         `Matemática.Discreta`,
         `Programação.II`,
         `Teoria.dos.Grafos`,
         `Fundamentos.de.Física.Clássica`,
         `Laboratório.de.Programação.II`,
         `cra`)

##### FIM DO PRE PROCESSAMENTO DOS DADOS #####
fitControl <- trainControl(method = "cv",
                           number = 10)
# Set seq of lambda to test
lambdaGrid <- expand.grid(lambda = 10^seq(10, -2, length=100))

ridge <- train(cra ~., data = graduados.treino.model.input,
               method='ridge',
               trControl = fitControl,
               tuneGrid = lambdaGrid
               )

ridge

lasso <- train(cra ~., data = graduados.treino.model.input,
               method='lasso')
lasso
```
